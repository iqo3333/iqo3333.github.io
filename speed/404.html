<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>404 未找到</title>
<link rel="icon" href="icons/favicon.png" type="image/png">

<style>
body {
  margin: 0;
  height: 100vh;
  background: #0b0b0e;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding-top: 25vh;
  color: #fff;
  font-family: "Consolas", "Monaco", monospace;
}

#container {
  position: relative;
  width: 100%;
  max-width: 450px;
  text-align: center;
  padding: 0 20px;
}

.message-box p {
  font-size: 20px;
  line-height: 32px;
  margin: 10px 0;
}

.caret::after {
  content: "▋";
  animation: blink 0.8s step-end infinite;
}
@keyframes blink {
  50% { opacity: 0; }
}

#circleBox {
  width: 140px;
  height: 140px;
  position: relative;
  margin: 40px auto 0 auto;
  display: none;
  display: flex;
  justify-content: center;
  align-items: center;
  
  /* 【渐显 CSS 1】: 默认透明，并设置过渡 */
  opacity: 0;
  transition: opacity 0.5s ease;
}

#circleBox svg {
  width: 140px;
  height: 140px;
  position: absolute;
  top: 0;
  left: 0;
  transform: rotate(-90deg);
}

#progress-bg {
  stroke: rgba(255,255,255,0.15);
  stroke-width: 10;
}

#progress-bar {
  stroke: url(#grad);
  stroke-width: 10;
  stroke-linecap: round;
  transition: stroke-dashoffset 1s linear;
}

#circle-num {
  position: absolute;
  font-size: 32px;
  font-weight: bold;
}

#jumpNow {
  margin-top: 30px; 
  padding: 8px 20px;
  font-size: 16px;
  background: rgba(255,255,255,0.12);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 10px;
  cursor: pointer;
  display: none;
  
  /* 【渐显 CSS 2】: 默认透明，并合并所有过渡 */
  opacity: 0;
  transition: opacity 0.5s ease, background 0.25s, border-color 0.25s;
}

#jumpNow:hover {
  background: rgba(255,255,255,0.25);
  border-color: rgba(255,255,255,0.45);
}
</style>
</head>

<body>
<div id="container">
  <div class="message-box">
    <p id="line1" class="caret"></p>
    <p id="line2" class="caret"></p>
    <p id="line3" class="caret"></p>
    <p id="line4" class="caret"></p>
  </div>

  <div id="circleBox">
    <svg>
      <defs>
        <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="0%">
          <stop offset="0%" stop-color="#6d93ff" />
          <stop offset="100%" stop-color="#9a6dff" />
        </linearGradient>
      </defs>
      <circle id="progress-bg" cx="70" cy="70" r="55" fill="none"></circle>
      <circle id="progress-bar" cx="70" cy="70" r="55" fill="none"></circle>
    </svg>
    <div id="circle-num">5</div>
  </div>

  <div id="jumpNow">立即跳转</div>
</div>

<script>
const FALLBACK_URL = "https://speed.iqo3333.cn/";
const TYPE_SPEED = 40;

const lines = [
  "抱歉您要找的页面不在这里，也许它已经搬家了。",
  "但不用担心，我会带你回到正确的地方。",
  "在此之前请检查输入的地址。",
  "页面将在5秒后自动跳转...",
];

function typeWriter(id, text, speed, callback) {
  let i = 0;
  function typing() {
    document.getElementById(id).textContent = text.slice(0, i);
    i++;
    if (i <= text.length) setTimeout(typing, speed);
    else {
      document.getElementById(id).classList.remove("caret");
      callback && callback();
    }
  }
  typing();
}

setTimeout(() => {
  typeWriter("line1", lines[0], TYPE_SPEED, () => {
    typeWriter("line2", lines[1], TYPE_SPEED, () => {
      typeWriter("line3", lines[2], TYPE_SPEED, () => {
       typeWriter("line4", lines[3], TYPE_SPEED, () => {
        startCountdown();
      });
    });
  });
 });
}, 300);


function getRedirectTarget() {
  try {
    if (!document.referrer) return FALLBACK_URL;
    const u = new URL(document.referrer);
    return u.origin + "/";
  } catch {
    return FALLBACK_URL;
  }
}

// 【已更新 JS】
function startCountdown() {
  const box = document.getElementById("circleBox");
  const jump = document.getElementById("jumpNow");
  const num = document.getElementById("circle-num");
  const bar = document.getElementById("progress-bar");

  // 1. 设置 display 让其占位（但仍透明）
  box.style.display = "flex";
  jump.style.display = "inline-block";

  // 2. 延迟 20ms 后设置 opacity，触发渐显
  setTimeout(() => {
    box.style.opacity = 1;
    jump.style.opacity = 1;
  }, 20);

  // 3. 倒计时逻辑 (不变)
  let total = 5;
  let t = total;

  const r = 55;
  const circ = 2 * Math.PI * r;

  bar.style.strokeDasharray = circ;
  bar.style.strokeDashoffset = 0;

  const target = getRedirectTarget();

const timer = setInterval(() => {
    t--;
    num.textContent = t;

    const offset = circ * ((total - t) / total);
    bar.style.strokeDashoffset = offset;

    if (t <= 0) {
      clearInterval(timer);
      
      // 【已修复】
      // 不要立即跳转，而是等待 1000 毫秒（1秒）
      // 以便让 CSS 的 1s 动画有时间播放完毕
      setTimeout(() => {
        location.href = target;
      }, 1000); 
    }
  }, 1000);

  jump.onclick = () => {
    clearInterval(timer);
    location.href = target;
  };
}
</script>
</body>
</html>